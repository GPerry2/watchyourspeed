var cot_login_app,cot_login=function(o){if(this.options=o,!this.options.appName)throw new Error("Error: the appName option is required");var i=this;$("#app-utility-login").load("html/cot_login.html? #loginModal",function(){i.modal=$("#loginModal"),i.modal.find("#cot_login").click(function(){i._login()}),i.modal.find("input").keydown(function(o){13===(o.charCode||o.keyCode||0)&&i._login()}),i._setUserName(),(i.options.onReady||function(){})(i)})};cot_login.prototype.showLogin=function(){this.modal.modal()},cot_login.prototype.isLoggedIn=function(){return!!this._cookie("sid")},cot_login.prototype.logout=function(){this._removeCookie("sid"),this._removeCookie("cot_uname"),this._removeCookie("email"),this._removeCookie("firstName"),this._removeCookie("lastName"),this._removeCookie("groups"),this.sid=this.username=this.email=this.firstName=this.lastName=this.groups="",this._setUserName(),window.location.reload()},cot_login.prototype._setUserName=function(){cot_login_app=this,this.isLoggedIn()?(this._loadUserInfo(),$(this.options.welcomeSelector).html("<div class='welcomemsg'><b>User Name</b>: "+this.username+" (<a class='logout' onclick='cot_login_app.logout();'>Logout</a>)</div>"),(this.options.onLogin||function(){})(this)):$(this.options.welcomeSelector).html("<div class='welcomemsg'><a class='login' onclick='cot_login_app.showLogin();'>Login</a></div>")},cot_login.prototype._login=function(){var o=this;this.modal.find(".btn").prop("disabled",!0),$.post((this.options.ccRoot||"")+"/cc_sr_admin_v1/session?app="+this.options.appName,{user:$("#username").val(),pwd:$("#password").val()},function(i){i.error?"invalid_user_or_pwd"===i.error&&o._displayLoginError("Invalid username or password"):(o._processLogin(i),o.modal.modal("hide"))}).fail(function(i,e,t){o._displayLoginError("Unable to log in. Please try again."),console.log("POST Request Failed: "+e+", "+t,arguments)}).always(function(i){o.modal.find(".btn").removeAttr("disabled").removeClass("disabled")})},cot_login.prototype._displayLoginError=function(o){$('<div class="alert alert-danger" role="alert">'+o+"</div>").prependTo(this.modal.find("#loginModalBody")).fadeOut(5e3,function(){$(this).remove()})},cot_login.prototype._processLogin=function(o){var i=new Date;o.passwordExpiryDate?i.setTime(o.passwordExpiryDate):i.setTime(i.getTime()+36e5),this._cookie("sid",o.sid,{expires:i}),this._cookie("cot_uname",o.userID,{expires:i}),this._cookie("email",(o.email||"").toLowerCase(),{expires:i}),o.cotUser&&(this._cookie("firstName",o.cotUser.firstName,{expires:i}),this._cookie("lastName",o.cotUser.lastName,{expires:i}),this._cookie("groups",o.cotUser.groupMemberships,{expires:i})),this._setUserName()},cot_login.prototype._loadUserInfo=function(){this.sid=this._cookie("sid"),this.username=this._cookie("cot_uname"),this.email=this._cookie("email"),this.firstName=this._cookie("firstName"),this.lastName=this._cookie("lastName"),this.groups=this._cookie("groups")},cot_login.prototype._cookie=function(o,i,e){return o&&(o=encodeURIComponent(this.options.appName)+"."+o),$.cookie(o,i,e)},cot_login.prototype._removeCookie=function(o){return $.removeCookie(encodeURIComponent(this.options.appName)+"."+o)};